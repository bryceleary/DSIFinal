---
title: "DSIFinal Project"
author: "Bryce Leary"
date: "1/11/2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r importclean, include=FALSE}
###Set-up
library(tidyverse)
library(here)
library(dendextend)
library(tinytex)


###Data Import
Depth <- read.csv(here("data", "Cleaning_FAO_Depth_Data.csv"))
DevAid <- read.csv(here("data", "Cleaning_OECDFAO_DevAid_Data.csv"))
FDI <- read.csv(here("data", "Cleaning_FAOSTAT_FDI_Data.csv"))
Nutrition <- read.csv(here("data", "Raw_Nutrition-Data.csv"))
Agexport <-read.csv(here("data", "Cleaning_FAOSTAT_Export_Data.csv"))
Agimport <- read.csv(here("data", "Cleaning_FAOSTAT_Import_Data.csv"))

  
##Clean Nutrition dataset
#Delete Unnecessary Variables
Nutrition <- select(Nutrition, -Domain.Code, -Domain, -Element.Code, -Element, 
                    -Item.Code, -Item, -Unit, -Flag, -Flag.Description, -Note)

#Rename variables
Nutrition <- rename(Nutrition, country_code = Area.Code)
Nutrition <- rename(Nutrition, country = Area)
Nutrition <- rename(Nutrition, adesa = Value)
Nutrition <- rename(Nutrition, year_spread = Year)
Nutrition <- rename(Nutrition, year = Year.Code)

#create year variable
Nutrition <- Nutrition %>% separate(year, into = c("year1", "year3"), sep = 4, 
                                    convert = TRUE)
Nutrition <- mutate(Nutrition, year = ((year3 + year1)/2))
Nutrition <- Nutrition %>% mutate(year1=NULL, year3=NULL)


###Clean Depth dataset
#Delete Unnecessary Variables
Depth <- select(Depth, -Country.Code, -Indicator.Name, -Indicator.Code, 
                -starts_with("X19"))
 
#Rename variables
Depth <- Depth %>%
  rename(country  = contains("Country.Name"),
         "2000" = X2000,
         "2001" = X2001,
         "2002" = X2002,
         "2003" = X2003,
         "2004" = X2004,
         "2005" = X2005,
         "2006" = X2006,
         "2007" = X2007,
         "2008" = X2008,
         "2009" = X2009,
         "2010" = X2010,
         "2011" = X2011,
         "2012" = X2012,
         "2013" = X2013,
         "2014" = X2014,
         "2015" = X2015,
         "2016" = X2016,
         "2017" = X2017,
         "2018" = X2018,
         "2019" = X2019)
Depth <- Depth %>% mutate_if(is.factor, as.character)
Depth <- Depth %>% mutate(country = replace(country, country == "Cote d'Ivoire", NA))
Depth <- replace_na(Depth, list(country="CÃ´te d'Ivoire"))

#Combine columns
Depth <- Depth %>% gather(starts_with("2"), key = "year", value = "depth")



###Clean DevAid dataset
#Delete Variables
DevAid <- select(DevAid, -Domain, -Element, -Element.Code, -Item, 
                 -Year.Code, -Unit, -Flag, -Flag.Description, -Note, 
                 -Domain.Code, -Item.Code, -Purpose)

#Combine the different purposes
DevAid <- DevAid %>% spread(Purpose.Code, Value)
DevAid[is.na(DevAid)] <- 0
DevAid <- DevAid %>%
  rename(prgm1  = "12240",
         prgm2 = "52010")
DevAid <- DevAid %>% mutate(donorflow = prgm1 + prgm2)
DevAid <- select(DevAid, -prgm1, -prgm2)

#Rename Variables
DevAid <- DevAid %>%
  rename(country = Recipient.Country,
         country_code = Recipient.Country.Code,
         donor_code = Donor.Code,
         year  = Year,
         donor = Donor)
DevAid <- select(DevAid, -donor_code)

#Spread the donor types
DevAid <- DevAid %>% spread(donor, donorflow)
DevAid <- DevAid %>%
  rename(bilateral = "Bilateral Donors",
         multilateral  = "Multilateral Donors",
         private = "Private Donors")

coalesce_by_column <- function(df) {
  return(coalesce(df[1], df[2]))
}
DevAid <- DevAid %>% group_by(country, year) %>% summarise_all(coalesce_by_column)


###Clean FDI dataset
#Delete Variables
FDI <- select(FDI, -Domain, -Element, -Element.Code, -Year.Code, 
              -Unit, -Item.Code, -Flag, -Flag.Description, -Note, -Domain.Code)

#Rename Variables
FDI <- FDI %>%
  rename("flow"  = Value,
         "country" = Area,
         "country_code" = Area.Code,
         "year" = Year,
         "item" = Item)

#Separate inflows and outflows
FDI <- FDI %>% spread(key = item, value = flow)

#Clean new variable structure and create netflow variable
FDI <- rename(FDI, "t_fdi_in" = "Total FDI inflows")
FDI <- rename(FDI, "t_fdi_out" = "Total FDI outflows")
FDI <- FDI %>% mutate(fdi_net = t_fdi_in-t_fdi_out)


###Clean Export dataset

#Delete Unnecessary Variables
Agexport <- select(Agexport, -Element, -Item, -Domain.Code, -Domain, 
                   -Element.Code, -Item.Code, -Year.Code, -Unit, -Flag, 
                   -Flag.Description)

#Rename variables
Agexport<- rename(Agexport, country_code = Area.Code)
Agexport <- rename(Agexport, country = Area)
Agexport <- rename(Agexport, export_value = Value)
Agexport <- rename(Agexport, year = Year)

#Divide the value by 1000
Agexport<- Agexport %>% mutate(exp_value =export_value/1000)

#Delete import-value variable
Agexport<- select(Agexport, -export_value)

###Clean Import dataset
#Delete Unnecessary Variables
Agimport <- select(Agimport, -Element, -Item, -Domain.Code, -Domain, 
                   -Element.Code, -Item.Code, -Year.Code, -Unit, -Flag, 
                   -Flag.Description)

#Rename variables
Agimport <- rename(Agimport, country_code = Area.Code)
Agimport <- rename(Agimport, country = Area)
Agimport <- rename(Agimport, import_value = Value)
Agimport <- rename(Agimport, year = Year)

#Divide the value by 1000
Agimport <- Agimport %>% mutate(imp_value =import_value/1000 )

#Delete import-value variable
Agimport <- select(Agimport, -import_value)
```


```{r merge, include=FALSE}
#Merge code
agriculture = merge(DevAid, FDI, by = c("year", "country", "country_code"), 
                     suffixes = c("",""))

agriculture = merge(agriculture, Nutrition, by = c("year", "country", "country_code"), 
                     suffixes = c("",""))

agriculture = merge(agriculture, Depth, by = c("year", "country"), 
                     suffixes = c("",""))

agriculture = merge(agriculture, Agexport, by = c("year", "country", "country_code"), 
                     suffixes = c(","))

agriculture = merge(agriculture, Agimport, by = c("year", "country", "country_code"), 
                     suffixes = c(","))

###Create net trade variable
agriculture <- agriculture %>% mutate(trade_net = exp_value - imp_value)
```

# Introduction

821 million people across the world suffered from hunger in 2018 according to the United Nations. Policymakers and global leaders are committed to ending hunger, and have codified this effort through the Millenium Challenge Goals, the Sustainable Development Goals, and the UN's Zero Hunger Challenge. These policymakers and global leaders face  many challenges however, and this analysis provides an analysis of food availability in West Africa. We seek to understand how capital flows in the agricultural sector influence the availability of food in West African countries. 

Our analysis finds that PUTFINDINGSHERE.

```{r}

```

#

```{r clustering, include=FALSE}
#Set up dataset for clustering
agcluster <- select(agriculture, -private, -t_fdi_in, -t_fdi_out, -fdi_net, -exp_value, -imp_value, -trade_net, -country_code, -year_spread)
agcluster <- na.omit(agcluster)
agcluster$adesa <- as.numeric(as.character(agcluster$adesa))
agcluster <- agcluster %>% mutate_at(c(3,4,5,6), funs(c(scale(.))))

#Create yearly interval cluster datasets
agcluster2000 <- agcluster %>% filter(year==2000)
agcluster2005 <- agcluster %>% filter(year==2005)
agcluster2010 <- agcluster %>% filter(year==2010)
agcluster2015 <- agcluster %>% filter(year==2015)
```

```{r dendrograms, error = FALSE, warning = FALSE, echo = FALSE}
clust2000 <- dist(agcluster2000, method = "euclidian")
den2000 <- hclust(clust2000, method = "complete")
plot(den2000, labels = c("Burkina Faso", "Ghana", "Guinea", "Mali", "Mauritania", "Niger",  "Senegal", "Sierra Leone"), main = "Clusters in 2000")

clust2005 <- dist(agcluster2005, method = "euclidian")
den2005 <- hclust(clust2005, method = "complete")
plot(den2005, labels = c("Burkina Faso", "CÃ´te d'Ivoire", "Ghana", "Guinea-Bissau",  "Guinea", "Liberia", "Mali", "Mauritania", "Niger",  "Nigeria",  "Senegal", "Sierra Leone", "Togo"), main = "Clusters in 2005")

clust2010 <- dist(agcluster2010, method = "euclidian")
den2010 <- hclust(clust2010, method = "complete")
plot(den2010, labels = c("Benin", "Burkina Faso", "CÃ´te d'Ivoire", "Ghana", "Guinea-Bissau", "Guinea", "Liberia", "Mali", "Mauritania", "Niger",  "Nigeria",  "Senegal", "Sierra Leone", "Togo"), main = "Clusters in 2010")

clust2015 <- dist(agcluster2015, method = "euclidian")
den2015 <- hclust(clust2015, method = "complete")
plot(den2015, labels = c("Benin", "Burkina Faso", "CÃ´te d'Ivoire", "Ghana", "Guinea-Bissau", "Guinea", "Liberia", "Mali", "Mauritania", "Niger",  "Nigeria",  "Senegal", "Sierra Leone", "Togo"), main ="Clusters in 2015")
```

``` {r den analysis, include=FALSE}

dend1 <- as.dendrogram(den2000)
dend2 <- as.dendrogram(den2005)
dend3 <- as.dendrogram(den2010)
dend4 <- as.dendrogram(den2015)
dend34list <- dendlist(dend3, dend4)
cor.dendlist(dend34list, method = "baker")
cor_bakers_gamma(dend3, dend4)
```

# Cluster Analysis
To more closely examine the trends uncovered by the linear regression model, we decided to complete a cluster analysis to examine how the different states have shifted in relation to each other. This analysis could potentially reveal additional information on how capital flows have impacted similar states. We focused on bilateral and multilateral development flows, as they contained the most complete data and clustering is ineffective with significant amounts of missing data. Due to the relatively small sample size, we utilized a hierarchical agglomerative method clustering process as it can identify nuance in small-n datasets which are harder to trace through k-means clustering. 

This process examined the shifts in clusters at four time markers: 2000, 2005, 2010, and 2015. These time periods were selected as they contain most of the data, avoid incomplete data, and prevent an oversaturation of the dendrogram. The results are summarized in dendrograms created through `hclust`, with the closeness between clusters summarized through the `height` variable on the Y-axis. 

Overall, we see countries moving further apart from each other as the millennium progressed. This is represented by the maximum height value moving from `r den2000[["height"]][7]` in 2000 to `r den2015[["height"]][13]` in 2015, a change of `r den2000[["height"]][7] - den2015[["height"]][13]`. We can also examine Baker’s Gamma correlation coefficient to determine the level of similarity between two dendrograms. Due to the varying size of the dendrograms, it is only possible to compare figure 3 and figure 4. Between these we find a Baker’s Gamma correlation of  `r cor_bakers_gamma(dend3, dend4)`. This  correlation coefficient indicates a strong similarity between the two models, though they are not exactly the same. While this correlation coefficient doesn’t account for height, we also see a change in similarity between the two years of `r den2010[["height"]][13] - den2015[["height"]][13]` as Niger continues to pull away from additional countries. Thus, while we see most countries experiencing similar effects of multinational and bilateral development aid 

